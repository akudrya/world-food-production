import os
import numpy as np
import rasterio

### Inputs
red= rasterio.open('red.TIF')
nir=rasterio.open('nir.TIF')
green=rasterio.open('green.TIF')


#### Outputs
strFC='falseColor.tiff'
strNDVI='ndvi.tiff'
strNDVIColor='ndviColor.tiff'

### False Color

profile = red.profile
profile.update(dtype=rasterio.uint8, count=3, nodata =0)

### Adjust values

numNp = 128
npRed = (red.read(1)/numNp)
npRed[npRed>255] = 255
npRed[npRed<0] = 0
npGrn = (green.read(1)/numNp)
npGrn[npGrn>255] = 255
npGrn[npGrn<0] = 0
npNir = (nir.read(1)/numNp)
npNir[npNir>255] = 255
npNir[npNir<0] = 0

### False color product

with rasterio.open(strFC, 'w', **profile) as dst:
    dst.write_band(1,npNir.astype(rasterio.uint8))
    dst.write_band(2,npRed.astype(rasterio.uint8))
    dst.write_band(3,npGrn.astype(rasterio.uint8))
    
## NDVI grey
npRed = red.read(1).astype(float)
npNir = nir.read(1).astype(float)


npNDVI = (np.true_divide((npNir - npRed),(npNir + npRed))+1)*127
npNDVI = np.nan_to_num(npNDVI)
npNDVI[npNDVI<0] = 0
npNDVI[npNDVI>255] = 255
npNDVI = npNDVI.astype(rasterio.uint8)

profile = red.profile
profile.update(dtype=rasterio.uint8, count=1, nodata =0)

with rasterio.open(strNDVI, 'w', **profile) as dst:
    dst.write_band(1,npNDVI)
    
## NDVI colormap

### NBR colormap
# arrColormap = [[0, 0, 1], [0, 2, 2], [1, 3, 3], [1, 5, 5], [1, 6, 6], [1, 8, 8], [2, 9, 9], [2, 11, 11],[2, 12, 12], [2, 14, 14], [3, 15, 15], [3, 17, 17], [3, 18, 18], [3, 20, 20],[4, 21, 21], [4, 23, 23], [4, 24, 24], [4, 26, 26], [5, 28, 27], [5, 29, 29],[5, 31, 30], [5, 32, 32], [6, 34, 33], [6, 35, 35], [6, 37, 36], [6, 38, 38],[7, 40, 39], [7, 41, 41], [7, 43, 42], [7, 44, 44], [8, 46, 45], [8, 47, 47],[8, 49, 48], [8, 50, 50], [9, 52, 51], [9, 54, 53], [9, 55, 54], [9, 57, 56],[10, 58, 57], [10, 60, 59], [10, 61, 60], [10, 63, 62], [11, 64, 63], [11, 66, 65],[11, 67, 66], [11, 69, 68], [12, 70, 69], [12, 72, 71], [12, 73, 72], [12, 75, 74],[13, 76, 75], [13, 78, 77], [14, 79, 78], [15, 80, 79], [16, 81, 80], [17, 83, 82],[17, 84, 83], [18, 85, 84], [19, 86, 85], [20, 87, 86], [21, 88, 87], [22, 90, 89],[23, 91, 90], [24, 92, 91], [24, 93, 92], [25, 94, 93], [26, 95, 94], [27, 97, 96],[28, 98, 97], [29, 99, 98], [30, 100, 99], [31, 101, 100], [32, 102, 101],[32, 103, 102], [33, 105, 104], [34, 106, 105], [35, 107, 106], [36, 108, 107],[37, 109, 108], [38, 110, 109], [39, 112, 111], [39, 113, 112], [40, 114, 113],[41, 115, 114], [42, 116, 115], [43, 117, 116], [44, 118, 117], [45, 120, 119],[46, 121, 120], [47, 122, 121], [47, 123, 122], [48, 124, 123], [49, 125, 124],[50, 127, 126], [51, 128, 127], [52, 129, 128], [53, 130, 129], [54, 131, 130],[54, 132, 131], [55, 134, 133], [56, 135, 134], [57, 136, 135], [58, 137, 136],[62, 139, 137], [66, 141, 138], [69, 143, 139], [73, 145, 139], [77, 147, 140],[81, 149, 141], [84, 151, 142], [88, 153, 143], [92, 155, 144], [96, 157, 144],[99, 159, 145], [103, 161, 146], [107, 163, 147], [111, 165, 148], [114, 167, 149],[118, 169, 149], [122, 171, 150], [126, 173, 151], [130, 175, 152], [133, 177, 153],[137, 179, 154], [141, 181, 155], [145, 183, 155], [148, 185, 156], [152, 187, 157],[156, 190, 158], [160, 192, 159], [163, 194, 160], [167, 196, 160], [171, 198, 161],[175, 200, 162], [178, 202, 163], [182, 204, 164], [186, 206, 165], [190, 208, 166],[194, 210, 166], [197, 212, 167], [201, 214, 168], [205, 216, 169], [209, 218, 170],[212, 220, 171], [216, 222, 171], [220, 224, 172], [224, 226, 173], [227, 228, 174],[231, 230, 175], [235, 232, 176], [239, 234, 176], [242, 236, 177], [246, 238, 178],[250, 240, 179], [248, 237, 177], [246, 235, 174], [244, 232, 172], [243, 229, 169],[241, 227, 167], [239, 224, 164], [237, 221, 162], [235, 219, 159], [233, 216, 157],[232, 213, 154], [230, 211, 152], [228, 208, 149], [226, 205, 147], [224, 203, 144],[222, 200, 142], [221, 197, 139], [219, 195, 137], [217, 192, 135], [215, 189, 132],[213, 187, 130], [211, 184, 127], [209, 181, 125], [208, 179, 122], [206, 176, 120],[204, 173, 117], [202, 171, 115], [200, 168, 112], [198, 165, 110], [197, 163, 107],[195, 160, 105], [193, 157, 102], [191, 155, 100], [189, 152, 97], [187, 149, 95],[185, 147, 93], [184, 144, 90], [182, 141, 88], [180, 139, 85], [178, 136, 83],[176, 133, 80], [174, 131, 78], [173, 128, 75], [171, 125, 73], [169, 123, 70],[167, 120, 68], [165, 117, 65], [163, 115, 63], [162, 112, 60], [160, 109, 58],[158, 107, 55], [156, 104, 53], [155, 104, 53], [155, 103, 52], [154, 103, 52],[154, 102, 51], [153, 102, 51], [152, 101, 51], [152, 101, 50], [151, 100, 50],[151, 100, 49], [150, 99, 49], [150, 99, 48], [149, 98, 48], [148, 98, 48],[148, 97, 47], [147, 97, 47], [147, 96, 46], [146, 96, 46], [145, 95, 46], [145, 95, 45],[144, 94, 45], [144, 94, 44], [143, 93, 44], [142, 93, 44], [142, 92, 43], [141, 92, 43],[141, 91, 42], [140, 91, 42], [140, 90, 41], [139, 90, 41], [138, 89, 41], [138, 89, 40],[137, 88, 40], [137, 88, 39], [136, 87, 39], [135, 87, 39], [135, 86, 38], [134, 86, 38],[134, 85, 37], [133, 85, 37], [132, 84, 37], [132, 84, 36], [131, 83, 36], [131, 83, 35],[130, 82, 35], [130, 82, 34], [129, 81, 34], [128, 81, 34], [128, 80, 33], [127, 80, 33],[127, 79, 32], [126, 79, 32]]

### NDVI new colormap

###arrColormap=[[56, 58, 62], [57, 59, 63], [58, 60, 64], [59, 61, 65], [60, 62, 66], [61, 64, 67],[61, 64, 68], [62, 65, 69], [63, 66, 70], [65, 67, 71], [66, 68, 72], [66, 69, 73],[67, 70, 73], [68, 71, 75], [69, 72, 76], [71, 73, 77], [72, 74, 78], [72, 75, 78],[74, 76, 80], [74, 77, 81], [75, 78, 82], [77, 79, 83], [78, 80, 84], [78, 81, 85],[80, 82, 86], [80, 83, 87], [81, 84, 88], [82, 84, 88], [84, 86, 90], [84, 87, 91],[85, 87, 91], [87, 89, 93], [87, 90, 93], [88, 91, 94], [90, 92, 96], [91, 93, 97],[91, 94, 97], [93, 95, 99], [93, 96, 99], [95, 97, 101], [95, 98, 101], [96, 99, 102],[97, 99, 103], [98, 100, 103], [99, 102, 105], [100, 103, 106], [101, 104, 107],[102, 105, 108], [103, 106, 109], [104, 106, 110], [105, 108, 111], [106, 108, 112],[107, 110, 113], [108, 110, 114], [109, 111, 115], [110, 112, 115], [111, 113, 117],[112, 114, 118], [113, 115, 119], [114, 116, 120], [114, 117, 120], [116, 118, 122],[117, 119, 122], [118, 120, 123], [119, 121, 124], [120, 122, 126], [121, 123, 126],[122, 124, 128], [122, 125, 128], [124, 126, 129], [124, 127, 130], [126, 128, 131],[127, 129, 132], [127, 129, 133], [129, 131, 134], [129, 132, 135], [131, 133, 136],[132, 134, 137], [133, 135, 138], [134, 136, 139], [135, 137, 140], [136, 138, 141],[137, 139, 142], [137, 139, 142], [139, 141, 144], [140, 142, 145], [141, 142, 145],[142, 144, 147], [143, 145, 148], [144, 146, 149], [145, 147, 150], [146, 148, 151],[147, 149, 152], [148, 150, 153], [149, 151, 154], [150, 152, 155], [151, 152, 155],[152, 154, 156], [152, 154, 157], [154, 156, 158], [155, 157, 159], [156, 158, 161],[157, 159, 161], [158, 160, 162], [159, 161, 164], [160, 161, 164], [160, 162, 165],[161, 163, 166], [163, 165, 167], [164, 165, 168], [164, 166, 169], [165, 167, 170],[166, 168, 171], [167, 169, 172], [168, 170, 173], [169, 171, 174], [170, 172, 174],[172, 173, 176], [172, 174, 177], [173, 175, 178], [175, 176, 179], [175, 177, 180],[176, 178, 181], [178, 179, 182], [178, 180, 182], [179, 181, 183], [180, 181, 184],[181, 183, 186], [182, 184, 186], [183, 184, 187], [184, 186, 189], [185, 187, 189],[186, 188, 190], [187, 189, 191], [189, 190, 193], [189, 191, 193], [190, 192, 194],[191, 193, 195], [192, 194, 196], [193, 194, 197], [194, 196, 198], [195, 197, 199],[196, 197, 200], [197, 199, 201], [198, 200, 202], [199, 200, 203], [200, 202, 204],[201, 203, 205], [202, 204, 206], [203, 205, 207], [204, 206, 208], [205, 207, 209],[205, 208, 209], [207, 209, 211], [208, 209, 211], [209, 211, 213], [210, 212, 214],[211, 213, 215], [212, 214, 216], [213, 214, 217], [214, 216, 218], [215, 216, 218],[216, 217, 219], [217, 218, 220], [218, 220, 222], [219, 220, 222], [220, 222, 224],[150, 17, 1], [158, 19, 1], [167, 21, 1], [173, 21, 1], [181, 24, 1], [188, 25, 1],[196, 27, 1], [202, 28, 1], [211, 30, 1], [222, 31, 1], [229, 33, 1], [238, 35, 1],[248, 37, 1], [255, 40, 1], [255, 46, 1], [255, 55, 1], [255, 63, 1], [255, 70, 1],[255, 78, 1], [255, 86, 1], [254, 95, 1], [255, 102, 1], [255, 109, 1], [255, 117, 1],[255, 123, 1], [255, 131, 1], [255, 139, 1], [255, 149, 1], [255, 155, 1], [255, 163, 1],[254, 169, 1], [255, 174, 1], [255, 179, 1], [254, 186, 1], [255, 192, 1], [255, 196, 1],[255, 202, 1], [255, 208, 1], [255, 212, 1], [255, 219, 1], [255, 225, 1], [255, 231, 1],[255, 235, 1], [254, 240, 1], [255, 246, 1], [254, 251, 1], [248, 248, 1], [243, 246, 1],[237, 244, 1], [232, 242, 1], [227, 240, 1], [220, 237, 1], [215, 235, 1], [210, 232, 1],[204, 230, 1], [198, 227, 1], [193, 225, 1], [186, 222, 1], [180, 219, 1], [175, 217, 1],[170, 216, 1], [165, 213, 1], [159, 211, 1], [153, 208, 1], [147, 204, 1], [141, 199, 1],[135, 195, 1], [130, 192, 1], [125, 188, 1], [117, 183, 1], [112, 179, 1], [106, 175, 1],[100, 171, 1], [94, 166, 1], [90, 164, 1], [82, 159, 1], [76, 154, 1], [72, 152, 1],[65, 147, 1], [59, 143, 1], [54, 139, 1], [48, 135, 1], [41, 130, 1], [36, 127, 1],[31, 123, 1], [25, 119, 1], [18, 114, 1], [11, 110, 1], [7, 107, 1]]

## Signal process NDVI

arrColormap=[[132,0,2],[132,0,2],[132,0,2],[132,0,2],[132,0,2],[132,0,2],[132,0,2],[132,0,2],[132,0,2],[132,0,2],[132,0,2],[132,0,2],[132,0,2],[132,0,2],[132,0,2],[132,0,2],[132,0,2],[132,0,2],[132,0,2],[132,0,2],[132,0,2],[132,0,2],[132,0,2],[132,0,2],[202,0,5],[202,0,5],[202,0,5],[202,0,5],[202,0,5],[202,0,5],[202,0,5],[202,0,5],[202,0,5],[202,0,5],[202,0,5],[202,0,5],[202,0,5],[202,0,5],[202,0,5],[202,0,5],[202,0,5],[202,0,5],[202,0,5],[202,0,5],[202,0,5],[202,0,5],[202,0,5],[251,41,9],[251,41,9],[251,41,9],[251,41,9],[251,41,9],[251,41,9],[251,41,9],[251,41,9],[251,41,9],[251,41,9],[251,41,9],[251,41,9],[251,41,9],[251,41,9],[251,41,9],[251,41,9],[251,41,9],[251,41,9],[251,41,9],[251,41,9],[251,41,9],[251,41,9],[251,41,9],[251,128,9],[251,128,9],[251,128,9],[251,128,9],[251,128,9],[251,128,9],[251,128,9],[251,128,9],[251,128,9],[251,128,9],[251,128,9],[251,128,9],[251,128,9],[251,128,9],[251,128,9],[251,128,9],[251,128,9],[251,128,9],[251,128,9],[251,128,9],[251,128,9],[251,128,9],[251,128,9],[254,199,9],[254,199,9],[254,199,9],[254,199,9],[254,199,9],[254,199,9],[254,199,9],[254,199,9],[254,199,9],[254,199,9],[254,199,9],[254,199,9],[254,199,9],[254,199,9],[254,199,9],[254,199,9],[254,199,9],[254,199,9],[254,199,9],[254,199,9],[254,199,9],[254,199,9],[254,199,9],[237,247,10],[237,247,10],[237,247,10],[237,247,10],[237,247,10],[237,247,10],[237,247,10],[237,247,10],[237,247,10],[237,247,10],[237,247,10],[237,247,10],[237,247,10],[237,247,10],[237,247,10],[237,247,10],[237,247,10],[237,247,10],[237,247,10],[237,247,10],[237,247,10],[237,247,10],[237,247,10],[185,225,7],[185,225,7],[185,225,7],[185,225,7],[185,225,7],[185,225,7],[185,225,7],[185,225,7],[185,225,7],[185,225,7],[185,225,7],[185,225,7],[185,225,7],[185,225,7],[185,225,7],[185,225,7],[185,225,7],[185,225,7],[185,225,7],[185,225,7],[185,225,7],[185,225,7],[185,225,7],[127,197,8],[127,197,8],[127,197,8],[127,197,8],[127,197,8],[127,197,8],[127,197,8],[127,197,8],[127,197,8],[127,197,8],[127,197,8],[127,197,8],[127,197,8],[127,197,8],[127,197,8],[127,197,8],[127,197,8],[127,197,8],[127,197,8],[127,197,8],[127,197,8],[127,197,8],[127,197,8],[83,175,5],[83,175,5],[83,175,5],[83,175,5],[83,175,5],[83,175,5],[83,175,5],[83,175,5],[83,175,5],[83,175,5],[83,175,5],[83,175,5],[83,175,5],[83,175,5],[83,175,5],[83,175,5],[83,175,5],[83,175,5],[83,175,5],[83,175,5],[83,175,5],[83,175,5],[83,175,5],[56,135,2],[56,135,2],[56,135,2],[56,135,2],[56,135,2],[56,135,2],[56,135,2],[56,135,2],[56,135,2],[56,135,2],[56,135,2],[56,135,2],[56,135,2],[56,135,2],[56,135,2],[56,135,2],[56,135,2],[56,135,2],[56,135,2],[56,135,2],[56,135,2],[56,135,2],[56,135,2],[13,88,1],[13,88,1],[13,88,1],[13,88,1],[13,88,1],[13,88,1],[13,88,1],[13,88,1],[13,88,1],[13,88,1],[13,88,1],[13,88,1],[13,88,1],[13,88,1],[13,88,1],[13,88,1],[13,88,1],[13,88,1],[13,88,1],[13,88,1],[13,88,1],[13,88,1],[13,88,1],[13,88,1],[13,88,1],[13,88,1]]

npNDVIcolor = np.zeros((3, npNDVI.shape[0], npNDVI.shape[1]), dtype=int).astype(np.uint8)

for i in range(0, len(arrColormap)):
    for j in range(0, 3):
        npNDVIcolor[j][npNDVI == i] = (arrColormap[255-i][j])
###

profile = red.profile
profile.update(dtype=rasterio.uint8, count=3, nodata=0)

with rasterio.open(strNDVIColor, 'w', **profile) as dst:
    dst.write_band(1,npNDVIcolor[0].astype(rasterio.uint8))
    dst.write_band(2,npNDVIcolor[1].astype(rasterio.uint8))
    dst.write_band(3,npNDVIcolor[2].astype(rasterio.uint8))